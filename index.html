<!DOCTYPE html>
<html lang="en">
<head>
    <title>OA in the PNW</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--meta data for sharing links on Facebook-->
    <meta property="og:title" content="Ocean Acidification in the Pacific Northwest"/>
    <meta property="og:url" content="https://briangkatz.github.io/oa-story/index.html"/>
    <meta property="og:description" content="A story map about regional vulnerability of shellfish stakeholders to ocean acidification"/>
    <meta property="og:image" content="img/geoviz_osu.png"/>

    <!--add required stylesheets-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css">
    <link rel="stylesheet" type="text/css" href="css/storymap.2.3.css">
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="assets/oyster_favicon.ico" type="image/x-icon">
    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <!--Font-->
    <link href="https://fonts.googleapis.com/css?family=Merienda" rel="stylesheet">

    <style>
        .feature-label {
            font-family: 'Merienda', sans-serif;
            color: #7b7b9b;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 0 3px #FFFFFF;
            background-color: rgba(0, 0, 0, 0);
            border: none;
            box-shadow: none;
        }

        .feature-tooltip {
            font-family: 'Merienda', sans-serif;
            color: #7b7b9b;
            font-size: 14px;
            font-weight: lighter;
        }

        .glyphicon-one-fine-smaller-dot:before {
            content: "\25cf";
            font-size: 1em;
        }

        .glow-effect {
            color: rgba(220, 220, 255, 0.6);
            text-shadow: 0 0 10px rgb(218, 218, 255);
        }
    </style>

    <!--add required libraries-->
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://cdn.bootcss.com/chroma-js/1.3.3/chroma.min.js"></script>
    <script src="js/bouncemarker.js"></script>

    <!--mini globle map-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="js/globeminimap.js"></script>

    <!--story map plugin-->
    <script src="js/storymap.2.3.js"></script>
</head>
<body>

<div id="storymap" class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 storymap-story">
            <section data-scene="overview" data-background="assets/tide.mp4">
                <div class="fullscreen text-center">
                    <h1>Ocean Acidification and the Shellfish Industry in the Pacific Northwest</h1>
                    <h1>
                        <small style="color: rgba(255,255,255,0.95)"> Assessing the vulnerability of regional shellfish stakeholders to the growing threat of ocean acidification.
                        </small>
                    </h1>
                </div>
            </section>
            <section data-scene="economics">
                <h2>Importance</h2>
                <p>Shellfish in the Pacific Northwest: history and economic importance</p>
                <img src="img/flats.png" class="img-responsive" alt="responsive image"
                     alt-text="Shellfish Farm">
            </section>

            <section data-scene="oa">
                <h2>Acidification</h2>
                <p>Anthropogenic change: CO2 emissions are acidifying the oceans</p>
                <video controls width="500px" class="embedded-photo">
                    <source src="assets/oa.mp4" />
                </video>

                <p><a href="https://www.youtube.com/watch?v=7h08ok3hFSs">Video</a> from YouTube by Oregon State University</p>
            </section>

            <section data-scene="shellfish">
                <h2>Impacts</h2>
                <p>Ocean acidification impacts shellfish growth and development</p>
                <img src="img/oyster.png" class="img-responsive" alt="responsive image"
                     alt-text="oyster">
            </section>

            <section data-scene="future">
                <h2>Looking Ahead</h2>
                <p>Industry at risk, needing adaptation strategies. What does the future hold?</p>
                <h3>Forecasts:</h3>
                <p>pH (acidity)</p>
                <video controls width="500px" class="embedded-photo">
                    <source src="assets/ph.mp4" /></video>
                <br>
                <p>Aragonite Saturation (corrosivity)</p>
                <video controls width="500px" class="embedded-photo">
                        <source src="assets/aragonite.mp4" />
            </section>
            <section data-scene="collaboration">
                <h2>Collaboration</h2>
                <p>RVA-OA project, collaboration, forecasting</p>
                <img src="img/osu_logo.png" class="img-responsive" alt="responsive image"
                     alt-text="Oregon State University logo">
                <img src="img/pacshell-logo.png" class="img-responsive" alt="responsive image"
                     alt-text="Pacific Shellfish Institute logo">
                <img src="img/noaa.png" class="img-responsive" alt="responsive image"
                     alt-text="NOAA logo">
            </section>

            <section data-scene="end" data-background="assets/tidal.jpg">
                <div class="fullscreen text-center">
                    <br/>
                    <h1 class="">Thanks for watching!!!</h1>
                    <h1>
                        <small style="color: rgba(255,255,255,0.95)">Download Storymap.js from
                            http://github.com/jakobzhao/storymap
                        </small>
                    </h1>
                </div>
            </section>

        </div>
        <!--map div-->
        <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>


    <dl>
        <dt>
            <!--facebook icon-->
            <a class="fa fa-facebook-square btn"
               href="https://facebook.com/sharer.php?u=https://briangkatz.github.io/oa-story/index.html"
               target="_blank"></a>
        </dt>
        <dt>
            <!--github icon-->
            <a class="fa fa-git-square btn" href="https://github.com/briangkatz/oa-story" style="top:40px"
               target="_blank"></a>
        </dt>
        <dt>
            <!--info icon-->
            <i class="fa fa-file-text-o btn" style="top:60px" data-toggle="modal" data-target="#info-modal"></i>
        </dt>
    </dl>

    <!--the info page-->
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About</h4>
                </div>
                <div class="modal-body">
                    <p>This story map describes the objectives of a research project at Oregon State University aimed at
                        assessing the regional vulnerability of Pacific Northwest shellfish stakeholders to the hazard of
                        ocean acidification. The story map library is derived from the
                        storymap plugin for leaflet at <a>http://atlefren.github.io/storymap/</a>, and its functionality
                        relies on both leaflet and Bootstrap.</p>
                    <p><b>storymap.js</b> | Released Date: 02/20/2017 | Version: 2.3 | MIT License </p>
                    <p><b>Author: Bo Zhao</b> | College of Earth, Ocean, Atmospheric Science | Oregon State University
                    </p>
                    <p>glow effect: https://adventuresinmapping.com/2016/10/17/firefly-cartography/</p>
                    <p>The context about the shellfish industry was collected from Wikipedia.</p>
                    <p>The <a href="https://www.youtube.com/watch?v=7h08ok3hFSs">video</a> on the Ocean Acidification page
                        was clipped from Youtube.</p>
                    <p>The favicon image was acquired from <a>https://pixabay.com/p-576545/?no_redirect</a>.</p>
                    <p>This story map uses geospatial data from mapbox, Google Earth Engine, ESRI Map, Open Street Maps
                        and Oregon Explorer.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- main javascript -->
<script type="text/javascript">

    //////////////////////////////////////////////////////////////////////////
    // Scene 1: Plain
    var ecoregions_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Ecoregions</b></p>';
    var ecoregions = L.geoJson.ajax('assets/upwelling_ecoregions.geojson', {
        color: 'black',
        weight: 2,
        opacity: 0.3,
        pointToLayer: function (feature, latlng) {
            // return L.circle(latlng, 1000 * Math.pow(Math.floor((Math.random() * 3) + 1), 2));
            return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-one-fine-smaller-dot glow-effect'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.ECOREGION, {sticky: true, className: "feature-tooltip"});
        }
    });

    //////////////////////////////////////////////////////////////////////////
    // Scene 2: Choropleth
    // Set function for color ramp
    function setColor(GROWER_CNT) {
        //Tenary operation: condition ? valueIfTrue : valueIfFalse
        // condition ? value1 : value2
        return GROWER_CNT > 60 ? '#b30000' :
            GROWER_CNT > 59 ? '#e34a33' :
                GROWER_CNT > 39 ? '#fc8d59' :
                    GROWER_CNT > 19 ? '#fdcc8a' :
                        '#fef0d9';
    }

    // Set style function that sets fill color property equal to grower count
    function style(feature) {
        return {
            fillColor: setColor(feature.properties.GROWER_CNT),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#ffffff',
            dashArray: '4'
        };
    }

    var ecoregions_choropleth = L.geoJson.ajax('assets/upwelling_ecoregions.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(feature.properties.GROWER_CNT, {
                    className: 'feature-label',
                    permanent: false,
                    direction: 'center',
                    sticky: true
                });
            }
        });


    var ecoregions_choropleth_legend = '<p><b># of Growers</b></p>' +
        '<i style="background: #ffffff; opacity: 0.5"></i><p><b>0</b></p>' +
        '<i style="background: #e8ded5; opacity: 0.5"></i><p><b>1 - 19</b></p>' +
        '<i style="background: #d0beac; opacity: 0.5"></i><p><b>20 - 39</b></p>' +
        '<i style="background: #b89e85; opacity: 0.5"></i><p><b>40 - 59</b></p>' +
        '<i style="background: #a08060; opacity: 0.5"></i><p><b>60+</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 3: Marker

   $('html > head').append($("<style> .marker-icon { color: red; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
   // $('html > head').append($("<style> .marker-icon { color: #0000ff; font-size: 15px; text-shadow:1px 1px 2px #ffffff, 0 0 25px rgba(0,0,255,0.75), 0 0 5px rgba(0,0,139,0.78);} </style>")); // glow effect: https://adventuresinmapping.com/2016/10/17/firefly-cartography/

    var growers = L.geoJson.ajax('assets/growers.geojson', {
        pointToLayer: function (feature, latlng) {

            delay = Math.floor((126 + latlng.lng) / 10 * 2000);
            //delay =Math.floor(Math.random() * 400);

            return L.marker(latlng, {
                bounceOnAdd: true,
                bounceOnAddOptions: {duration: 200, height: window.innerHeight, delay: delay},
                icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon'})
            });
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Company, {sticky: true, className: "feature-tooltip"});
        }
    });


    var grower_legend = '<i class="glyphicon glyphicon-star marker-icon"></i><p><b>Shellfish Growers</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 4: Grower Markers categorized by Region

    var colors = chroma.scale('Set2').mode('lch').colors(10);
    for (i = 1; i < 11; i++) {
        $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }

    var growers_color = L.geoJson.ajax('assets/growers.geojson', {
        pointToLayer: function (feature, latlng) {
            if (feature.properties.Region === "Alaska") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-1'})});
            } else if (feature.properties.Region === "Hood Canal") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-2'})});
            } else if (feature.properties.Region === "North Sound") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-3'})});
            } else if (feature.properties.Region === "South Sound") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-4'})});
            } else if (feature.properties.Region === "Grays Harbor") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-5'})});
            } else if (feature.properties.Region === "Willapa Bay") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-6'})});
            } else if (feature.properties.Region === "Northern Oregon") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-7'})});
            } else if (feature.properties.Region === "Southern Oregon") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-8'})});
            } else if (feature.properties.Region === "California") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-9'})});
            } else {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-star marker-icon-10'})});
            }
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Region, {sticky: true, className: "feature-tooltip"});
        }
    });

    var growers_color_legend = '<p><b>Shellfish Grower Regions</b></p>' +
        '<i class="glyphicon glyphicon-star marker-icon-1"></i><p>Alaska</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-2"></i><p>Hood Canal</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-3"></i><p>North Puget Sound</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-4"></i><p>South Puget Sound</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-5"></i><p>Grays Harbor</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-6"></i><p>Willapa Bay</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-7"></i><p>Northern Oregon</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-8"></i><p>Southern Oregon</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-9"></i><p>California</p>' +
        '<i class="glyphicon glyphicon-star marker-icon-10"></i><p>Others</p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 5: circleMarker

    var collaboration_circle = L.geoJson.ajax('assets/collaboration.geojson', {
        style: function (feature) {
            return {
                fillColor: chroma.random(),
                fillOpacity: 0.4,
                stroke: true,
                weight: 10,
                opacity: 0.8,
                color: '#a0a0c0'
            };
        },
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng);
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.name, {sticky: true, className: "feature-tooltip"});
        }
    });

    var collaboration_circle_legend = '<i class=""><svg height="16" width="16"> <circle cx="8" cy="8" r="6" stroke="white" stroke-width="1" fill="red" fillOpacity="0.4" /> </svg></i><p><b>Research Partners</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 6: circleMarker in glow effects

    var growers_circle2 = L.geoJson.ajax('assets/growers.geojson', {
        pointToLayer: function (feature, latlng) {
           // return L.circle(latlng, 1000 * Math.pow(Math.floor((Math.random() * 3) + 1), 2));
            return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-one-fine-smaller-dot glow-effect'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Company, {sticky: true, className: "feature-tooltip"});
        }
    });

    var growers_circle2_legend = '<i class=""><svg height="16" width="16"> <circle cx="8" cy="8" r="6" stroke="white" stroke-width="0" fill="#00ff00" fillOpacity="0.4" /> </svg></i><p><b>Shellfish Growers</b></p>';

    var darkLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');

    //////////////////////////////////////////////////////////////////////////

    var layers = {
        ecoregions: {layer: ecoregions, legend: ecoregions_legend},
        ecoregions_choropleth: {layer: ecoregions_choropleth, legend: ecoregions_choropleth_legend},
        growers: {layer: growers, legend: grower_legend},
        growers_color: {layer: growers_color, legend: growers_color_legend},
        collaboration_circle: {layer: collaboration_circle, legend: collaboration_circle_legend},
        growers_circle2: {layer: growers_circle2, legend: growers_circle2_legend},
        darkLayer: {layer: darkLayer},
        ESRI: {layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')},

        GEE: {
            layer: L.tileLayer('http://earthengine.google.org/static/hansen_2013/tree_alpha/{z}/{x}/{y}.png'),
            legend: grower_legend
        },
        satellite: {
            layer: L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {
                id: 'mapbox.satellite'
            })
        },
        shellfish: {
            layer: L.tileLayer('https://api.mapbox.com/styles/v1/katzbr/cj98q07zp1rdq2sthjwng5xci/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia2F0emJyIiwiYSI6ImNqOHhmMnBucDIwZm4ycW8ya2d5cHF0cmsifQ.8rcjz0DyWs_ncWfOZ0VwKA\n')
        },
        Mapbox_Dark: {
            layer: L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {
                id: 'mapbox.dark', detectRetina: true
            })
        },
        cartodb_light: {layer: L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png')}
    };

    var scenes = {
        overview: {lat: 55, lng: -138, zoom: 4, name: 'Overview'},
        economics: {lat: 46.688927, lng: -123.5, zoom: 7, name: 'Economic Importance', layers: ['growers_circle2', 'darkLayer']},
        oa: {lat: 46.688927, lng: -123.5, zoom: 7, name: 'Ocean Acidification', layers: ['shellfish', 'ecoregions_choropleth']},
        shellfish: {lat: 45.408, lng: -123.947140, zoom: 14, name: 'Shellfish Impacts', layers: ['satellite']},
        future: {lat: 55, lng: -138, zoom: 4, name: 'Looking Ahead', layers: ['ecoregions', 'growers_color', 'ESRI']},
        collaboration: {lat: 47, lng: -111, zoom: 5, name: 'Collaboration', layers: ['collaboration_circle', 'cartodb_light']},
        end: {lat: 44.0000000, lng: -123.5000000, zoom: 7, name: 'The End'}
    };

    $('#storymap').storymap({
        scenes: scenes,
        layers: layers,
        baselayer: layers.shellfish,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        credits: "",
        loader: true,
        scalebar: false,
        navwidget: true,

        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map($(".storymap-map")[0], {zoomControl: false, scrollWheelZoom: false}).setView([55, -138], 4);

            //add an miniglobe
            new L.Control.GlobeMiniMap({
                marker: 'red',
                position: 'bottomright'
            }).addTo(map);


            return map;
        }
    });
</script>
</body>
</html>